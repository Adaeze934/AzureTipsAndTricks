(window.webpackJsonp=window.webpackJsonp||[]).push([[285],{721:function(e,t,n){"use strict";n.r(t);var r=n(69),a=Object(r.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),n("p",[e._v("ðŸ”¥ Make sure you "),n("a",{attrs:{href:"https://github.com/microsoft/azuretipsandtricks",target:"_blank",rel:"noopener noreferrer"}},[e._v("star the repo"),n("OutboundLink")],1),e._v(" to keep up to date with new tips and tricks.")]),e._v(" "),n("p",[e._v("ðŸ’¡ Learn more : "),n("a",{attrs:{href:"https://docs.microsoft.com/azure/event-grid/overview?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Event Grid overview"),n("OutboundLink")],1),e._v(".")]),e._v(" "),n("p",[e._v("ðŸ“º Watch the video : "),n("a",{attrs:{href:"https://youtu.be/BiGJb_w7TME?WT.mc_id=youtube-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("How to receive Azure Event Grid events in an Azure Function"),n("OutboundLink")],1),e._v(".")])]),e._v(" "),n("h3",{attrs:{id:"how-to-receive-azure-event-grid-events-in-an-azure-function"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#how-to-receive-azure-event-grid-events-in-an-azure-function"}},[e._v("#")]),e._v(" How to receive Azure Event Grid events in an Azure Function")]),e._v(" "),n("h4",{attrs:{id:"event-driven-applications"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#event-driven-applications"}},[e._v("#")]),e._v(" Event-driven applications")]),e._v(" "),n("p",[e._v("Many modern applications are distributed and are event-driven. This means that processes in the application execute when an event is received, like an event that gets raised when a new file is uploaded. Event-driven applications promote high availability, resilience, and only run when they need to. "),n("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/event-grid/overview?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Event Grid"),n("OutboundLink")],1),e._v(" is the central service in Azure that enables event-driven applications. It provides an event gateway that connects events from Azure and third-party services to event handlers, like your application.")]),e._v(" "),n("p",[e._v("In this post, we'll use an "),n("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-functions/?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Function"),n("OutboundLink")],1),e._v(" to receive an event from "),n("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/event-grid/overview?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Event Grid"),n("OutboundLink")],1),e._v(".")]),e._v(" "),n("h4",{attrs:{id:"prerequisites"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),n("p",[e._v("If you want to follow along, you'll need the following:")]),e._v(" "),n("ul",[n("li",[e._v("An Azure subscription (If you don't have an Azure subscription, create a "),n("a",{attrs:{href:"https://azure.microsoft.com/free/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("free account"),n("OutboundLink")],1),e._v(" before you begin)")]),e._v(" "),n("li",[e._v("An existing "),n("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-functions/?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Function app"),n("OutboundLink")],1),e._v(". Learn how to create one in this "),n("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-functions/functions-get-started?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("quickstart"),n("OutboundLink")],1)])]),e._v(" "),n("h4",{attrs:{id:"use-an-azure-function-as-event-handler"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#use-an-azure-function-as-event-handler"}},[e._v("#")]),e._v(" Use an Azure Function as event handler")]),e._v(" "),n("p",[e._v("We'll use an existing Azure Function App, and create a new Function in it that will receive events from Azure Event Grid.")]),e._v(" "),n("ol",[n("li",[e._v("Go to the "),n("a",{attrs:{href:"https://portal.azure.com/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure portal"),n("OutboundLink")],1),e._v(" and navigate to an existing Azure Function app")]),e._v(" "),n("li",[e._v("Navigate to the "),n("strong",[e._v("Functions")]),e._v(" menu")]),e._v(" "),n("li",[e._v("Click the "),n("strong",[e._v('"+ Create"')]),e._v(" button to start creating a new Function\n"),n("ol",[n("li",[e._v("Leave the "),n("strong",[e._v("Development environment")]),e._v(" to "),n("strong",[e._v('"Develop in portal"')])]),e._v(" "),n("li",[e._v("Select the "),n("strong",[e._v('"Azure Event Grid trigger"')]),e._v(" template")]),e._v(" "),n("li",[e._v("Enter a "),n("strong",[e._v("Name")]),e._v(" for the Function")]),e._v(" "),n("li",[e._v("Click "),n("strong",[e._v("Create")])])])])]),e._v(" "),n("img",{attrs:{src:e.$withBase("/files/143createfunction.png")}}),e._v(" "),n("p",[e._v("(Create a new Function in the Azure portal)")]),e._v(" "),n("p",[e._v("The Function will act as the event handler. Now, we need to create an Event Grid Topic. We can use this to raise events.")]),e._v(" "),n("ol",[n("li",[e._v("In the Azure portal, use the search bar to search for "),n("strong",[e._v('"Event Grid Topics"')]),e._v(" and select the result")]),e._v(" "),n("li",[e._v("Click the "),n("strong",[e._v('"+ Create"')]),e._v(" button to Create a new Topic\n"),n("ol",[n("li",[e._v("Select a "),n("strong",[e._v("Resource group")])]),e._v(" "),n("li",[e._v("Enter a "),n("strong",[e._v("Name")]),e._v(" for the Topic")]),e._v(" "),n("li",[e._v("Pick a "),n("strong",[e._v("Region")])]),e._v(" "),n("li",[e._v("Click "),n("strong",[e._v("Review + create")]),e._v(" and then "),n("strong",[e._v("Create")])])])])]),e._v(" "),n("img",{attrs:{src:e.$withBase("/files/143createtopic.png")}}),e._v(" "),n("p",[e._v("(Create a new Event Grid Topic in the Azure portal)")]),e._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[e._v("When the Topic is created, you'll automatically navigate to its overview blade. We need to create a subscription for this topic, so that the event handler (the Function) is subscribed to the events of the topic. Click the "),n("strong",[e._v('"+ Event Subscription"')]),e._v(" button to start creating a new subscription\n"),n("ol",[n("li",[e._v("Enter a "),n("strong",[e._v("Name")]),e._v(" for the subscription")]),e._v(" "),n("li",[e._v("For "),n("strong",[e._v("Endpoint Type")]),e._v(", select "),n("strong",[e._v("Azure Function")])]),e._v(" "),n("li",[e._v("Select the Function that we created earlier for the "),n("strong",[e._v("Endpoint")])]),e._v(" "),n("li",[e._v("Click "),n("strong",[e._v("Create")]),e._v(" to create the subscription")])])])]),e._v(" "),n("img",{attrs:{src:e.$withBase("/files/143createsubscription.png")}}),e._v(" "),n("p",[e._v("(Create an Event subscription in the Azure portal)")]),e._v(" "),n("p",[e._v("The Function is now subscribed to events that are raised for the Event Grid Topic. Let's create an event manually to trigger the Function.")]),e._v(" "),n("ol",[n("li",[e._v("In the Azure portal, open the "),n("strong",[e._v("Azure Cloud Shell")]),e._v(" (or go to "),n("a",{attrs:{href:"https://shell.azure.com/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://shell.azure.com/"),n("OutboundLink")],1),e._v(")")]),e._v(" "),n("li",[e._v("Select "),n("strong",[e._v("PowerShell")]),e._v(" as the language")]),e._v(" "),n("li",[e._v("Execute the following script to set parameters for the resource group and Event Grid Topic name. Enter the values of the Event Grid Topic")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("$resourceGroupName = <resource group name>\n$topicName = <topic name>\n")])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br")])]),n("ol",{attrs:{start:"4"}},[n("li",[e._v("Now execute the following command. This creates an event for the Event Grid Topic")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('$endpoint = (Get-AzEventGridTopic -ResourceGroupName $resourceGroupName -Name $topicName).Endpoint\n$keys = Get-AzEventGridTopicKey -ResourceGroupName $resourceGroupName -Name $topicName\n\n$eventID = Get-Random 99999\n\n#Date format should be SortableDateTimePattern (ISO 8601)\n$eventDate = Get-Date -Format s\n\n#Construct body using Hashtable\n$htbody = @{\n    id= $eventID\n    eventType="recordInserted"\n    subject="myapp/vehicles/motorcycles"\n    eventTime= $eventDate   \n    data= @{\n        make="Ducati"\n        model="Monster"\n    }\n    dataVersion="1.0"\n}\n\n#Use ConvertTo-Json to convert event body from Hashtable to JSON Object\n#Append square brackets to the converted JSON payload since they are expected in the event\'s JSON payload syntax\n$body = "["+(ConvertTo-Json $htbody)+"]"\n\nInvoke-WebRequest -Uri $endpoint -Method POST -Body $body -Headers @{"aeg-sas-key" = $keys.Key1}\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br")])]),n("ol",{attrs:{start:"5"}},[n("li",[e._v("Go back to the Azure Function and click on the "),n("strong",[e._v("Monitor menu")]),e._v(", or look at the "),n("strong",[e._v("Log")]),e._v(" in the "),n("strong",[e._v("Code blade")]),e._v(". You'll see that the Function was triggered when the event was raised, and that it received the data in the event")])]),e._v(" "),n("img",{attrs:{src:e.$withBase("/files/143result.png")}}),e._v(" "),n("p",[e._v("(Azure Function triggered by the event)")]),e._v(" "),n("h4",{attrs:{id:"conclusion"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[e._v("#")]),e._v(" Conclusion")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://docs.microsoft.com/azure/event-grid/overview?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Event Grid"),n("OutboundLink")],1),e._v(" is the glue for event-driven, serverless applications that are highly available and only run when they are needed. Go and check it out!")])])}),[],!1,null,null,null);t.default=a.exports}}]);