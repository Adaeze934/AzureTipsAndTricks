(window.webpackJsonp=window.webpackJsonp||[]).push([[260],{696:function(e,t,a){"use strict";a.r(t);var s=a(69),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),a("p",[e._v("ðŸ”¥  Download the FREE Azure Developer Guide eBook "),a("a",{attrs:{href:"http://aka.ms/azuredevebook?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("ðŸ’¡ Learn more : "),a("a",{attrs:{href:"https://docs.microsoft.com/azure/batch/batch-technical-overview?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Batch overview"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("p",[e._v("ðŸ“º Watch the video : "),a("a",{attrs:{href:"https://youtu.be/EueNoWNXB3Q?WT.mc_id=youtube-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("How to run jobs at scale with Azure Batch"),a("OutboundLink")],1),e._v(".")])]),e._v(" "),a("h3",{attrs:{id:"how-to-run-jobs-at-scale-with-azure-batch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-to-run-jobs-at-scale-with-azure-batch"}},[e._v("#")]),e._v(" How to run jobs at scale with Azure Batch")]),e._v(" "),a("h4",{attrs:{id:"scaling-out-jobs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scaling-out-jobs"}},[e._v("#")]),e._v(" Scaling out jobs")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://docs.microsoft.com/azure/batch/batch-technical-overview?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Batch"),a("OutboundLink")],1),e._v(" is designed to run jobs at scale. These can be jobs that calculate things, transform data, encode media, and so on. There are several flavors of Azure Batch, like "),a("a",{attrs:{href:"https://docs.microsoft.com/azure/batch/batch-rendering-service?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Batch Rendering"),a("OutboundLink")],1),e._v(", which renders 3D models, and the "),a("a",{attrs:{href:"https://azure.microsoft.com/services/batch/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Batch Service"),a("OutboundLink")],1),e._v(", which is used to run any other task or script at scale. Azure Batch can execute tasks on multiple compute nodes to speed up the process. It can orchestrate data and results across tasks, so that multiple nodes can work to complete a single result.")]),e._v(" "),a("p",[e._v("In this post, we'll execute a simple command line script over multiple compute nodes with Azure Batch Service.")]),e._v(" "),a("h4",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),a("p",[e._v("If you want to follow along, you'll need the following:")]),e._v(" "),a("ul",[a("li",[e._v("An Azure subscription (If you don't have an Azure subscription, create a "),a("a",{attrs:{href:"https://azure.microsoft.com/free/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("free account"),a("OutboundLink")],1),e._v(" before you begin)")])]),e._v(" "),a("h4",{attrs:{id:"create-a-batch-service-account-and-execute-tasks-with-it"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-a-batch-service-account-and-execute-tasks-with-it"}},[e._v("#")]),e._v(" Create a Batch Service account and execute tasks with it")]),e._v(" "),a("p",[e._v("You use Azure Batch Service by creating a Batch account, a compute pool, jobs for that pool, and tasks for those jobs. We'll start by creating the Azure Batch Service account in the Azure portal.")]),e._v(" "),a("ol",[a("li",[e._v("Go to the "),a("a",{attrs:{href:"https://portal.azure.com/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure portal"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("Click the "),a("strong",[e._v("Create a resource")]),e._v(" button (the plus-sign in the top left corner)")]),e._v(" "),a("li",[e._v("Search for "),a("strong",[e._v("batch")]),e._v(", select the "),a("strong",[e._v('"Batch Service"')]),e._v(" result and click "),a("strong",[e._v("Create")]),e._v(" "),a("ol",[a("li",[e._v("Select a "),a("strong",[e._v("Resource Group")])]),e._v(" "),a("li",[e._v("Fill in a "),a("strong",[e._v("Name")])]),e._v(" "),a("li",[e._v("Select a "),a("strong",[e._v("Location")]),e._v(" for the account")]),e._v(" "),a("li",[e._v("Click "),a("strong",[e._v("Next: Advanced")])]),e._v(" "),a("li",[e._v("In the Advanced tab, you can configure security details for the Batch account. Leave the settings as they are and click "),a("strong",[e._v("Review + create")])]),e._v(" "),a("li",[e._v("Click "),a("strong",[e._v("Create")]),e._v(" to create the account")])])])]),e._v(" "),a("img",{attrs:{src:e.$withBase("/files/141create.png")}}),e._v(" "),a("p",[e._v("(Create an Azure Batch Service account in the Azure portal)")]),e._v(" "),a("p",[e._v("The Azure Batch Service account can have multiple pools of compute nodes in it. You use these to execute jobs with tasks. Let's create a compute pool.")]),e._v(" "),a("ol",[a("li",[e._v("In the Azure Batch Service account, navigate to the "),a("strong",[e._v("Pools")]),e._v(" menu")]),e._v(" "),a("li",[e._v("Click the "),a("strong",[e._v('"+ Add"')]),e._v(" button to start adding a pool")]),e._v(" "),a("li",[e._v("Enter a "),a("strong",[e._v("name")]),e._v(" for the pool under "),a("strong",[e._v("Pool ID")])]),e._v(" "),a("li",[e._v("For "),a("strong",[e._v("Image Type")]),e._v(", pick "),a("strong",[e._v("Marketplace")])]),e._v(" "),a("li",[e._v("Pick "),a("strong",[e._v('"microsoftwindowsserver"')]),e._v(" for "),a("strong",[e._v("Publisher")])]),e._v(" "),a("li",[e._v("Choose "),a("strong",[e._v('"windowsserver"')]),e._v(" for "),a("strong",[e._v("Offer")])]),e._v(" "),a("li",[e._v("Pick "),a("strong",[e._v('"2019-datacenter-core-smaldisk"')]),e._v(" for the "),a("strong",[e._v("Sku")]),e._v(" setting")]),e._v(" "),a("li",[e._v("Next, under "),a("strong",[e._v("Scale")]),e._v(", set the "),a("strong",[e._v('"Target dedicated nodes"')]),e._v(" to "),a("strong",[e._v("2")]),e._v(". This will scale the pool to two nodes. The nodes are Azure VMs that will be the size of the "),a("strong",[e._v("VM size")]),e._v(" setting")]),e._v(" "),a("li",[e._v("Finally, under "),a("strong",[e._v("Virtual Network")]),e._v(", select one, or create a new one and select it")]),e._v(" "),a("li",[e._v("Click "),a("strong",[e._v("OK")]),e._v(" to create the pool. The pool will be created instantly and needs some time to spin up the VM nodes")])]),e._v(" "),a("img",{attrs:{src:e.$withBase("/files/141addpool.png")}}),e._v(" "),a("p",[e._v("(Create the Azure Batch pool)")]),e._v(" "),a("ol",{attrs:{start:"11"}},[a("li",[e._v("Now that we have a compute pool, we can create Jobs for it. These are the things that contains the tasks that will be executed. You can schedule jobs, and jobs can contain multiple tasks. Click on the "),a("strong",[e._v("Jobs")]),e._v(" menu")]),e._v(" "),a("li",[e._v("Click the "),a("strong",[e._v('"+ Add"')]),e._v(" button")]),e._v(" "),a("li",[e._v("Enter a "),a("strong",[e._v("Job ID")]),e._v(" for the job")]),e._v(" "),a("li",[e._v("Click "),a("strong",[e._v("Select pool")]),e._v(" and select the pool that we've just created")]),e._v(" "),a("li",[e._v("Select "),a("strong",[e._v("OK")]),e._v(" to add the Job")])]),e._v(" "),a("img",{attrs:{src:e.$withBase("/files/141addjob.png")}}),e._v(" "),a("p",[e._v("(Create a job in the Azure Batch pool)")]),e._v(" "),a("ol",{attrs:{start:"16"}},[a("li",[e._v("Let's create a Task. In the "),a("strong",[e._v("Jobs menu")]),e._v(", select the "),a("strong",[e._v("Job")]),e._v(" that we've created")]),e._v(" "),a("li",[e._v("Navigate to the "),a("strong",[e._v("Tasks menu")])]),e._v(" "),a("li",[e._v("Click the "),a("strong",[e._v('"+ Add"')]),e._v(" button to create a new Task")]),e._v(" "),a("li",[e._v("Enter a "),a("strong",[e._v("name")]),e._v(" for the Task under "),a("strong",[e._v("Task ID")])]),e._v(" "),a("li",[e._v("In the command line text box, enter the following command. This will retrieve the environment variables of Azure Batch and wait for 90 seconds")])]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('cmd /c "set AZ_BATCH & timeout /t 90 > NUL"\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("ol",{attrs:{start:"21"}},[a("li",[e._v("Leave the rest of the settings as they are and click "),a("strong",[e._v("OK")]),e._v(" to add the Task")])]),e._v(" "),a("img",{attrs:{src:e.$withBase("/files/141addtask.png")}}),e._v(" "),a("p",[e._v("(Create a task)")]),e._v(" "),a("ol",{attrs:{start:"22"}},[a("li",[e._v("Repeat the steps to create another task with the same command")]),e._v(" "),a("li",[e._v("Tasks that are created will execute automatically on available nodes in the pool. After a few minutes, you can see the "),a("strong",[e._v("results")]),e._v(" in the Tasks menu of the job. The Tasks both executed and will have run on different nodes, as they became available again.")])]),e._v(" "),a("img",{attrs:{src:e.$withBase("/files/141result.png")}}),e._v(" "),a("p",[e._v("(The task executed)")]),e._v(" "),a("p",[e._v("The file "),a("strong",[e._v("stdout.txt")]),e._v(" contains the output of the task. Click on it to see the Batch environment variables, which will looks like this:")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("AZ_BATCH_ACCOUNT_URL=https://batchtip.eastus.batch.azure.com/\nAZ_BATCH_POOL_ID=mypool\nAZ_BATCH_NODE_ID=tvmps_d006643821944bc06982523e1c6c78d362612ed49e38e90ca70354b4aee29f82_d\nAZ_BATCH_ACCOUNT_NAME=batchtip\nAZ_BATCH_NODE_ROOT_DIR=D:\\batch\\tasks\nAZ_BATCH_NODE_SHARED_DIR=D:\\batch\\tasks\\shared\nAZ_BATCH_NODE_STARTUP_DIR=D:\\batch\\tasks\\startup\nAZ_BATCH_NODE_STARTUP_WORKING_DIR=D:\\batch\\tasks\\startup\\wd\nAZ_BATCH_NODE_IS_DEDICATED=true\nAZ_BATCH_NODE_MOUNTS_DIR=D:\\batch\\tasks\\fsmounts\nAZ_BATCH_RESERVED_DISK_SPACE_BYTES=1000000000\nAZ_BATCH_RESERVED_EPHEMERAL_DISK_SPACE_BYTES=1000000000\nAZ_BATCH_OS_RESERVED_EPHEMERAL_DISK_SPACE_BYTES=1000000000\nAZ_BATCH_JOB_ID=myjob\nAZ_BATCH_TASK_ID=mytask\nAZ_BATCH_TASK_DIR=D:\\batch\\tasks\\workitems\\myjob\\job-1\\mytask\nAZ_BATCH_TASK_WORKING_DIR=D:\\batch\\tasks\\workitems\\myjob\\job-1\\mytask\\wd\nAZ_BATCH_TASK_USER_IDENTITY=PoolNonAdmin\nAZ_BATCH_TASK_USER=PoolNonAdmin72876713\n\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br")])]),a("h4",{attrs:{id:"conclusion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[e._v("#")]),e._v(" Conclusion")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://docs.microsoft.com/azure/batch/batch-technical-overview?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Batch Service"),a("OutboundLink")],1),e._v(" is great for running jobs at scale. Go and check it out!")])])}),[],!1,null,null,null);t.default=r.exports}}]);