(window.webpackJsonp=window.webpackJsonp||[]).push([[245],{684:function(e,r,t){"use strict";t.r(r);var a=t(69),s=Object(a.a)({},(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),t("p",[e._v("ðŸ”¥  Help shape the future of Azure Tips and Tricks by telling what you'd like for us to write about "),t("a",{attrs:{href:"https://github.com/microsoft/AzureTipsAndTricks/issues/new?assignees=&labels=&template=survey.md&title=",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("ðŸ’¡ Learn more : "),t("a",{attrs:{href:"https://docs.microsoft.com/azure/aks/intro-kubernetes?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Kubernetes Service overview"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("ðŸ“º Watch the video : "),t("a",{attrs:{href:"https://youtu.be/53-Y_aI0KpE?WT.mc_id=youtube-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("How to run an App Service Web App on Azure Arc-enabled Kubernetes - Part 2"),t("OutboundLink")],1),e._v(".")])]),e._v(" "),t("h3",{attrs:{id:"how-to-run-an-app-service-web-app-on-azure-arc-enabled-kubernetes-part-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#how-to-run-an-app-service-web-app-on-azure-arc-enabled-kubernetes-part-2"}},[e._v("#")]),e._v(" How to run an App Service Web App on Azure Arc-enabled Kubernetes - Part 2")]),e._v(" "),t("h4",{attrs:{id:"manage-kubernetes-from-azure"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#manage-kubernetes-from-azure"}},[e._v("#")]),e._v(" Manage Kubernetes from Azure")]),e._v(" "),t("p",[e._v("Kubernetes is a powerful container orchestrator technology that enables you to run a solution with many containers. "),t("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-arc/overview?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Arc"),t("OutboundLink")],1),e._v(" can make your Kubernetes cluster part of Azure so that you can manage it from Azure, just like an "),t("a",{attrs:{href:"https://azure.microsoft.com/services/kubernetes-service/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Kubernetes Service"),t("OutboundLink")],1),e._v(". And you can use that Kubernetes cluster as compute to run other services, like "),t("a",{attrs:{href:"https://azure.microsoft.com/services/app-service/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("App Service"),t("OutboundLink")],1),e._v(", "),t("a",{attrs:{href:"https://docs.microsoft.com/azure/event-grid/kubernetes/?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Event Grid"),t("OutboundLink")],1),e._v(", and "),t("a",{attrs:{href:"https://docs.microsoft.com/azure/api-management/how-to-deploy-self-hosted-gateway-azure-arc?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("API Management Gateway"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("This post is the second part of a series of three. In this post, we'll add a Kubernetes cluster to Azure using "),t("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-arc/kubernetes/overview?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Arc-enabled Kubernetes"),t("OutboundLink")],1),e._v(" and run an "),t("a",{attrs:{href:"https://azure.microsoft.com/services/app-service/web/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("App Service Web app"),t("OutboundLink")],1),e._v(" on it.")]),e._v(" "),t("h4",{attrs:{id:"prerequisites"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),t("p",[e._v("If you want to follow along, you'll need the following:")]),e._v(" "),t("ul",[t("li",[e._v("An Azure subscription (If you don't have an Azure subscription, create a "),t("a",{attrs:{href:"https://azure.microsoft.com/free/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("free account"),t("OutboundLink")],1),e._v(" before you begin)")]),e._v(" "),t("li",[e._v("A computer that is onboarded to Azure Arc-enabled servers. You can follow "),t("a",{attrs:{href:"https://microsoft.github.io/AzureTipsAndTricks/blog/tip343.html?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("part 1 of this series of posts"),t("OutboundLink")],1),e._v(" to get started\n"),t("ul",[t("li",[e._v("The Arc-enabled server needs to adhere to "),t("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-arc/kubernetes/quickstart-connect-cluster?tabs=azure-cli#prerequisites&WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("all of the prerequisites"),t("OutboundLink")],1),e._v(", including having a Kubernetes cluster, the Azure CLI, and more")])])])]),e._v(" "),t("h4",{attrs:{id:"add-kubernetes-to-azure-arc"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#add-kubernetes-to-azure-arc"}},[e._v("#")]),e._v(" Add Kubernetes to Azure Arc")]),e._v(" "),t("p",[e._v("I have a computer that is Arc-enabled, and managed by Azure. It runs Docker Desktop with "),t("a",{attrs:{href:"https://docs.docker.com/docker-for-windows/#kubernetes?WT.mc_id=other-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("a Kubernetes cluster enabled"),t("OutboundLink")],1),e._v(" in it. I can manage the health and configuration of the computer from Azure, but I can't manage the Kubernetes cluster from Azure yet. Let's change that.")]),e._v(" "),t("p",[e._v("Before you can onboard a Kubernetes cluster to Azure Arc, you need to make sure that the machine that runs the cluster adheres to all of "),t("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-arc/kubernetes/quickstart-connect-cluster?tabs=azure-cli#prerequisites&WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("the requirements"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("img",{attrs:{src:e.$withBase("/files/128prerequisites.png")}}),e._v(" "),t("p",[e._v("(Prerequisites before adding a Kubernetes cluster to Azure Arc)")]),e._v(" "),t("p",[e._v("When your machine and cluster are ready, you can add the cluster:")]),e._v(" "),t("ol",[t("li",[e._v("On the Arc-enabled computer, start a command prompt")]),e._v(" "),t("li",[e._v("Login to Azure using "),t("strong",[e._v("az login")]),e._v(". This will ask you for your credentials. If you have multiple Azure subscriptions, you might need to "),t("a",{attrs:{href:"https://docs.microsoft.com/cli/azure/manage-azure-subscriptions-azure-cli#change-the-active-subscription?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("select the subscription"),t("OutboundLink")],1),e._v(" that you want to use")]),e._v(" "),t("li",[e._v("Next, create a resource group using the command below. This will be used to connect Kubernetes to Azure")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("az group create --name AzureArcTest --location EastUS --output table\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[e._v("Use the next command to connect Kubernetes to Azure Arc. Use the name of the resource group and pick a name for how the Kubernetes cluster should be named in Azure. This can take 5 to 10 minutes to complete")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("az connectedk8s connect --name [kubernetes context name] --resource-group AzureArcTest\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("After a while, the Kubernetes cluster is connected to Azure Arc.")]),e._v(" "),t("ol",[t("li",[e._v("Go to the "),t("a",{attrs:{href:"https://portal.azure.com/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure portal"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("Search for "),t("strong",[e._v('"Azure Arc"')]),e._v(" in the search box and click on the result. You will now see the Azure Arc overview blade")]),e._v(" "),t("li",[e._v("Navigate to the "),t("strong",[e._v("Kubernetes clusters")]),e._v(" menu")]),e._v(" "),t("li",[e._v("You'll see the connected Kubernetes cluster. Click on it")])]),e._v(" "),t("img",{attrs:{src:e.$withBase("/files/128result.png")}}),e._v(" "),t("p",[e._v("(Arc-connected Kubernetes cluster)")]),e._v(" "),t("ol",{attrs:{start:"5"}},[t("li",[e._v("Now, you can manage the cluster from Azure and monitor it. Click on the "),t("strong",[e._v("Insights")]),e._v(" menu. You might need to enable monitoring. When that is done, you'll see performance and health metrics of the Kubernetes cluster. You can even drill down into its Nodes")])]),e._v(" "),t("img",{attrs:{src:e.$withBase("/files/128monitoring.png")}}),e._v(" "),t("p",[e._v("(Drill down into node metrics of the Arc-connected Kubernetes cluster)")]),e._v(" "),t("ol",{attrs:{start:"6"}},[t("li",[e._v("Let's do something really cool. You can use the Kubernetes that is running on the Arc-enabled machine, as compute to run other services, like "),t("a",{attrs:{href:"https://azure.microsoft.com/services/app-service/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("App Services"),t("OutboundLink")],1),e._v(". Click on the "),t("strong",[e._v("Extensions")]),e._v(" menu")]),e._v(" "),t("li",[e._v("Click "),t("strong",[e._v("Add")])]),e._v(" "),t("li",[e._v("Select "),t("strong",[e._v("Application service extension")]),e._v(", and then click "),t("strong",[e._v("Create")]),e._v(" "),t("ol",[t("li",[e._v("Fill in a "),t("strong",[e._v("Name")]),e._v(" for the extension")]),e._v(" "),t("li",[e._v("For "),t("strong",[e._v("Custom location")]),e._v(", click "),t("strong",[e._v("Create new")]),e._v(" and fill in a "),t("strong",[e._v("Name")]),e._v(" and "),t("strong",[e._v("Namespace")]),e._v(', like "appservice"')]),e._v(" "),t("li",[e._v("Next, you'll need the publicly reachable static IP address that your local Kubernetes cluster uses. Use it for "),t("strong",[e._v("Static IP")])]),e._v(" "),t("li",[e._v("Leave "),t("strong",[e._v("Storage class")]),e._v(" as is")]),e._v(" "),t("li",[e._v("Click "),t("strong",[e._v("Next")])]),e._v(" "),t("li",[e._v("For now, leave "),t("strong",[e._v("Enable logs")]),e._v(" unchecked")]),e._v(" "),t("li",[e._v("Click "),t("strong",[e._v("Next")])]),e._v(" "),t("li",[e._v("And click "),t("strong",[e._v("Next")]),e._v(" again")]),e._v(" "),t("li",[e._v("Now copy the "),t("strong",[e._v("script")])])])])]),e._v(" "),t("img",{attrs:{src:e.$withBase("/files/128addappservice.png")}}),e._v(" "),t("p",[e._v("(Add App Service extension for Azure Arc wizard)")]),e._v(" "),t("ol",{attrs:{start:"9"}},[t("li",[e._v("Go to the Arc-enabled computer that runs the Kubernetes cluster")]),e._v(" "),t("li",[e._v("Open an elevated "),t("strong",[e._v("PowerShell")]),e._v(" prompt")]),e._v(" "),t("li",[e._v("Paste in the script that we've generated in the Azure portal. This will prompt you to sign in to Azure and might ask you to allow network traffic through a firewall. Wait until the script is done. This can take a while")]),e._v(" "),t("li",[e._v("When the script is finished, an App Service environment is running in the Kubernetes service on the local machine. Now, we can create App Services, like a Web App, in it. The PowerShell script below creates a new Web App in the environment and deploys a sample Node.js application from a GitHub repo into it. Change the parameters for "),t("strong",[e._v("resourceGroup")]),e._v(", "),t("strong",[e._v("customLocationName")]),e._v(", "),t("strong",[e._v("appServicePlanName")]),e._v(", and "),t("strong",[e._v("webAppName")]),e._v(" to your values.")])]),e._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('$resourceGroup="AzureArcTest"\n$customLocationName="tipsapploc"\n$appServicePlanName="ArcAppPlan"\n$webAppName="MyArcTipsAppService"\n\n$customLocationId=$(az customlocation show --resource-group $resourceGroup --name $customLocationName --query id --output tsv)\n\naz appservice plan create -g $resourceGroup -n $appServicePlanName --custom-location $customLocationId --per-site-scaling --is-linux --sku K1\n\naz webapp create --plan $appServicePlanName --resource-group $resourceGroup --name $webAppName --custom-location $customLocationId --% --runtime \'NODE|12-lts\'\n\ngit clone https://github.com/Azure-Samples/nodejs-docs-hello-world\ncd nodejs-docs-hello-world\nCompress-Archive -Path * -DestinationPath package.zip\naz webapp deployment source config-zip --resource-group $resourceGroup --name $webAppName --src package.zip\n')])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br"),t("span",{staticClass:"line-number"},[e._v("4")]),t("br"),t("span",{staticClass:"line-number"},[e._v("5")]),t("br"),t("span",{staticClass:"line-number"},[e._v("6")]),t("br"),t("span",{staticClass:"line-number"},[e._v("7")]),t("br"),t("span",{staticClass:"line-number"},[e._v("8")]),t("br"),t("span",{staticClass:"line-number"},[e._v("9")]),t("br"),t("span",{staticClass:"line-number"},[e._v("10")]),t("br"),t("span",{staticClass:"line-number"},[e._v("11")]),t("br"),t("span",{staticClass:"line-number"},[e._v("12")]),t("br"),t("span",{staticClass:"line-number"},[e._v("13")]),t("br"),t("span",{staticClass:"line-number"},[e._v("14")]),t("br"),t("span",{staticClass:"line-number"},[e._v("15")]),t("br")])]),t("p",[e._v("After running the script, you can check in the Azure portal if the App Service Web App shows up. You'll see it when you go to the "),t("strong",[e._v("App Services")]),e._v(" resource. It has most of the normal App Service Web App features.")]),e._v(" "),t("img",{attrs:{src:e.$withBase("/files/128appservice.png")}}),e._v(" "),t("p",[e._v("(App Service Web App running on Kubernetes)")]),e._v(" "),t("p",[e._v('When you visit the Web App URL, you\'ll see the sample application, which is a simple page that says "Hello world!".')]),e._v(" "),t("img",{attrs:{src:e.$withBase("/files/128result2.png")}}),e._v(" "),t("p",[e._v("(Sample application running in an App Service on Kubernetes, on a on-premises computer)")]),e._v(" "),t("h4",{attrs:{id:"conclusion"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[e._v("#")]),e._v(" Conclusion")]),e._v(" "),t("p",[t("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-arc/overview?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Arc"),t("OutboundLink")],1),e._v(" can use an "),t("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-arc/kubernetes/overview?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Arc-enabled Kubernetes cluster"),t("OutboundLink")],1),e._v(" as compute for services like "),t("a",{attrs:{href:"https://azure.microsoft.com/services/app-service/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("App Service"),t("OutboundLink")],1),e._v(". This enables you to run App Services like "),t("a",{attrs:{href:"https://azure.microsoft.com/services/app-service/web/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Web Apps"),t("OutboundLink")],1),e._v(" and "),t("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-functions/?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Functions"),t("OutboundLink")],1),e._v(" on your machine that runs on-premises, on the edge, or in another data center. Go and check it out!")])])}),[],!1,null,null,null);r.default=s.exports}}]);