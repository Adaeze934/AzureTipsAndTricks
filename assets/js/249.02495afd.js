(window.webpackJsonp=window.webpackJsonp||[]).push([[249],{767:function(e,t,n){"use strict";n.r(t);var s=n(59),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),n("p",[e._v("ðŸ”¥  Help shape the future of Azure Tips and Tricks by telling what you'd like for us to write about "),n("a",{attrs:{href:"https://github.com/microsoft/AzureTipsAndTricks/issues/new?assignees=&labels=&template=survey.md&title=",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),n("OutboundLink")],1),e._v(".")]),e._v(" "),n("p",[e._v("ðŸ’¡ Learn more : "),n("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-functions/functions-overview?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Introduction to Azure Functions"),n("OutboundLink")],1),e._v(".")]),e._v(" "),n("p",[e._v("ðŸ“º Watch the video : "),n("a",{attrs:{href:"https://youtu.be/roWbjuo-c30?WT.mc_id=youtube-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("How to create custom handlers for Azure Functions"),n("OutboundLink")],1),e._v(".")])]),e._v(" "),n("h3",{attrs:{id:"how-to-create-custom-handlers-for-azure-functions"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#how-to-create-custom-handlers-for-azure-functions"}},[e._v("#")]),e._v(" How to create custom handlers for Azure Functions")]),e._v(" "),n("h4",{attrs:{id:"run-code-in-any-language-with-azure-functions"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#run-code-in-any-language-with-azure-functions"}},[e._v("#")]),e._v(" Run code in any language with Azure Functions")]),e._v(" "),n("p",[n("a",{attrs:{href:"https://azure.microsoft.com/services/functions/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Functions"),n("OutboundLink")],1),e._v(" are great for running serverless pieces of code. Functions also provide "),n("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-functions/functions-triggers-bindings?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("triggers and bindings"),n("OutboundLink")],1),e._v(", which make it easy to start a function, receive data and do something with that data, without writing plumbing code. You could already create Azure Functions in many languages, and now with "),n("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-functions/functions-custom-handlers?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Custom Handlers"),n("OutboundLink")],1),e._v(", you can have a Function trigger any type of code.")]),e._v(" "),n("p",[e._v("Custom Handlers are lightweight web servers that receive events from the Azure Functions host. Any language that supports HTTP calls can implement a custom handler.")]),e._v(" "),n("p",[e._v("In this post, we'll use "),n("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-functions/functions-custom-handlers?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Custom Handlers"),n("OutboundLink")],1),e._v(" to run Go code.")]),e._v(" "),n("h4",{attrs:{id:"prerequisites"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),n("p",[e._v("If you want to follow along, you'll need the following:")]),e._v(" "),n("ul",[n("li",[e._v("An Azure subscription (If you don't have an Azure subscription, create a "),n("a",{attrs:{href:"https://azure.microsoft.com/free/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("free account"),n("OutboundLink")],1),e._v(" before you begin)")]),e._v(" "),n("li",[e._v("The latest version of "),n("a",{attrs:{href:"https://golang.org/doc/install?WT.mc_id=other-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Go"),n("OutboundLink")],1)]),e._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/Azure/azure-functions-core-tools/releases/tag/3.0.2931?WT.mc_id=github-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Functions Core Tools"),n("OutboundLink")],1),e._v(" (v3 or higher)")]),e._v(" "),n("li",[e._v("The "),n("a",{attrs:{href:"https://code.visualstudio.com/download?WT.mc_id=other-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("latest version of VS Code"),n("OutboundLink")],1)]),e._v(" "),n("li",[e._v("The "),n("a",{attrs:{href:"https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurefunctions&WT.mc_id=other-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Functions extension"),n("OutboundLink")],1),e._v(" for VS Code")])]),e._v(" "),n("h4",{attrs:{id:"trigger-go-code-with-an-azure-function"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#trigger-go-code-with-an-azure-function"}},[e._v("#")]),e._v(" Trigger Go code with an Azure Function")]),e._v(" "),n("p",[e._v("Let's create an Azure Function that runs code in the Go language. We'll start by creating and running a Function locally and deploy it to Azure after that.")]),e._v(" "),n("ol",[n("li",[e._v("Open Visual Studio Code")]),e._v(" "),n("li",[e._v("Go to the "),n("strong",[e._v("Azure")]),e._v(" menu. Here, you'll see the Functions section")]),e._v(" "),n("li",[e._v("Let's create a local Azure Function. Click on the "),n("strong",[e._v("Create New Project")]),e._v(" button")])]),e._v(" "),n("img",{attrs:{src:e.$withBase("/files/104create.png")}}),e._v(" "),n("p",[e._v("(Create new local Function project in VS Code)")]),e._v(" "),n("ol",{attrs:{start:"4"}},[n("li",[e._v("Select a folder location to store the project and click "),n("strong",[e._v("Select")])]),e._v(" "),n("li",[e._v("This starts the creation wizard. First, select "),n("strong",[e._v("Custom Handler")]),e._v(" as the language for the project")])]),e._v(" "),n("img",{attrs:{src:e.$withBase("/files/104custom.png")}}),e._v(" "),n("p",[e._v("(Select Custom Handler in VS Code)")]),e._v(" "),n("ol",{attrs:{start:"6"}},[n("li",[e._v("Next, select "),n("strong",[e._v("HTTP trigger")]),e._v(" for the Function template")]),e._v(" "),n("li",[e._v('Name the local function "'),n("strong",[e._v("GoExample")]),e._v("\". This exact name is important, because we'll need it later")]),e._v(" "),n("li",[e._v("Select "),n("strong",[e._v("Anonymous")]),e._v(" for the Authorization level")]),e._v(" "),n("li",[e._v("Finally, select "),n("strong",[e._v("Add to workspace")]),e._v(" to create the Function")])]),e._v(" "),n("p",[e._v("The Function will open in VS Code and is a normal, HTTP Triggered Function. Let's add a Go file to it.")]),e._v(" "),n("ol",[n("li",[e._v("Right-click the explorer window and select "),n("strong",[e._v("New File")]),e._v(" in the root of the Function")]),e._v(" "),n("li",[e._v("Name the file "),n("strong",[e._v("handler.go")])])]),e._v(" "),n("img",{attrs:{src:e.$withBase("/files/104go.png")}}),e._v(" "),n("p",[e._v("(handler.go file in the root of the Function in VS Code)")]),e._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[e._v("Paste the following Go code into the Go file. This uses the Custom Handlers feature to forward HTTP requests to the helloHandler and execute that. This way, you can execute code in whatever language you want, like Go code in this example. Make sure that the name of the function in the line "),n("strong",[e._v('"http.HandleFunc("/api/GoExample"')]),e._v(", is the same as the name of the Function")])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('package main\n\n import (\n \t"fmt"\n \t"log"\n \t"net/http"\n \t"os"\n )\n\n func helloHandler(w http.ResponseWriter, r *http.Request) {\n \tmessage := "This HTTP triggered function executed successfully from Go. Pass a name in the query string for a personalized response.\\n"\n \tname := r.URL.Query().Get("name")\n \tif name != "" {\n \t\tmessage = fmt.Sprintf("Hello, %s. This HTTP triggered function executed successfully from Go.\\n", name)\n \t}\n \tfmt.Fprint(w, message)\n }\n\n func main() {\n \tlistenAddr := ":8080"\n \tif val, ok := os.LookupEnv("FUNCTIONS_CUSTOMHANDLER_PORT"); ok {\n \t\tlistenAddr = ":" + val\n \t}\n \thttp.HandleFunc("/api/GoExample", helloHandler)\n \tlog.Printf("About to listen on %s. Go to https://127.0.0.1%s/", listenAddr, listenAddr)\n \tlog.Fatal(http.ListenAndServe(listenAddr, nil))\n }\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br"),n("span",{staticClass:"line-number"},[e._v("24")]),n("br"),n("span",{staticClass:"line-number"},[e._v("25")]),n("br"),n("span",{staticClass:"line-number"},[e._v("26")]),n("br"),n("span",{staticClass:"line-number"},[e._v("27")]),n("br")])]),n("ol",{attrs:{start:"4"}},[n("li",[e._v("Open a "),n("strong",[e._v("terminal window")]),e._v(" (Terminal > New Terminal)")]),e._v(" "),n("li",[e._v("Type "),n("strong",[e._v('"build handler.go"')]),e._v(" and hit "),n("strong",[e._v("enter")]),e._v(". This compiles the Go file into an executable. On Windows, this results in a file called "),n("strong",[e._v("handler.exe")])]),e._v(" "),n("li",[e._v("Now we need to change the "),n("strong",[e._v("host.json file")]),e._v('. In it, we need to change the customHandler section to point to the handler.exe file (which can have a different name, like "handler", on Linux). The host.json file should look like this:')])]),e._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v('{\n  "version": "2.0",\n  "logging": {\n    "applicationInsights": {\n      "samplingSettings": {\n        "isEnabled": true,\n        "excludedTypes": "Request"\n      }\n    }\n  },\n  "extensionBundle": {\n    "id": "Microsoft.Azure.Functions.ExtensionBundle",\n    "version": "[1.*, 2.0.0)"\n  },\n  "customHandler": {\n    "description": {\n      "defaultExecutablePath": "handler.exe",\n      "workingDirectory": "",\n      "arguments": []\n    },\n    "enableForwardingHttpRequest": true\n  }\n}\n')])]),e._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[e._v("1")]),n("br"),n("span",{staticClass:"line-number"},[e._v("2")]),n("br"),n("span",{staticClass:"line-number"},[e._v("3")]),n("br"),n("span",{staticClass:"line-number"},[e._v("4")]),n("br"),n("span",{staticClass:"line-number"},[e._v("5")]),n("br"),n("span",{staticClass:"line-number"},[e._v("6")]),n("br"),n("span",{staticClass:"line-number"},[e._v("7")]),n("br"),n("span",{staticClass:"line-number"},[e._v("8")]),n("br"),n("span",{staticClass:"line-number"},[e._v("9")]),n("br"),n("span",{staticClass:"line-number"},[e._v("10")]),n("br"),n("span",{staticClass:"line-number"},[e._v("11")]),n("br"),n("span",{staticClass:"line-number"},[e._v("12")]),n("br"),n("span",{staticClass:"line-number"},[e._v("13")]),n("br"),n("span",{staticClass:"line-number"},[e._v("14")]),n("br"),n("span",{staticClass:"line-number"},[e._v("15")]),n("br"),n("span",{staticClass:"line-number"},[e._v("16")]),n("br"),n("span",{staticClass:"line-number"},[e._v("17")]),n("br"),n("span",{staticClass:"line-number"},[e._v("18")]),n("br"),n("span",{staticClass:"line-number"},[e._v("19")]),n("br"),n("span",{staticClass:"line-number"},[e._v("20")]),n("br"),n("span",{staticClass:"line-number"},[e._v("21")]),n("br"),n("span",{staticClass:"line-number"},[e._v("22")]),n("br"),n("span",{staticClass:"line-number"},[e._v("23")]),n("br")])]),n("ol",{attrs:{start:"7"}},[n("li",[e._v("That's it. Let's try it out. In the terminal type "),n("strong",[e._v("func start")]),e._v(" and hit "),n("strong",[e._v("enter")]),e._v(". This starts the Function locally and shows you the URL at which it is running")]),e._v(" "),n("li",[e._v("Copy the URL for the Function from the output window and paste it in a browser and add "),n("strong",[e._v('"?name=Go"')]),e._v(" to the end of the URL. This is the query parameter that the Go code takes and displays")])]),e._v(" "),n("img",{attrs:{src:e.$withBase("/files/104localresult.png")}}),e._v(" "),n("p",[e._v("(Result of running the Function locally)")]),e._v(" "),n("p",[e._v("The Function works locally. The Custom Handler in Go intercepts the HTTP Trigger and invokes the Go method that executes Go code. Let's take this Function App and run it in Azure.")]),e._v(" "),n("ol",[n("li",[e._v("In VS Code, go to the "),n("strong",[e._v("Azure")]),e._v(" menu")]),e._v(" "),n("li",[e._v("If you're not logged into Azure, click "),n("strong",[e._v("Sign in to Azure")]),e._v(" and follow the instructions")]),e._v(" "),n("li",[e._v("Click the "),n("strong",[e._v("Deploy to Function App")]),e._v(" button. This starts the deployment wizard")]),e._v(" "),n("li",[e._v("Select "),n("strong",[e._v('"Create new Function App in Azure... Advanced"')])]),e._v(" "),n("li",[e._v("Fill in a unique "),n("strong",[e._v("Name")]),e._v(" for the Function App")]),e._v(" "),n("li",[e._v("Select "),n("strong",[e._v("Custom Handler")]),e._v(" as the runtime stack")])]),e._v(" "),n("img",{attrs:{src:e.$withBase("/files/104deploy1.png")}}),e._v(" "),n("p",[e._v("(Select Custom Handler as the runtime for the Azure Function App)")]),e._v(" "),n("ol",{attrs:{start:"7"}},[n("li",[e._v("Now pick "),n("strong",[e._v("Windows")]),e._v(" for the OS. We pick Windows, because we compiled the handler executable for Windows. If you want to run the Function on Linux:\n"),n("ol",[n("li",[e._v("Recompile the handler.go file with "),n("strong",[e._v('"GOOS=linux GOARCH=amd64 go build handler.go"')])]),e._v(" "),n("li",[e._v("Change host.json to point to "),n("strong",[e._v("handler")]),e._v(" instead of handler.exe")])])]),e._v(" "),n("li",[e._v("Pick "),n("strong",[e._v("Consumption")]),e._v(" for the hosting plan")]),e._v(" "),n("li",[e._v("Select a "),n("strong",[e._v("Resource Group")]),e._v(" for the Function App")]),e._v(" "),n("li",[e._v("Next, select a "),n("strong",[e._v("Storage Account")]),e._v(" for the Function App")]),e._v(" "),n("li",[e._v("Finally, pick "),n("strong",[e._v('"Skip for now"')]),e._v(" when you are asked to select an Application Insights resource. That's it. The Function app will now be created and the code will be deployed to it")]),e._v(" "),n("li",[e._v("When the Function App is created and the Function is deployed to Azure, refresh the Functions in VS Code")]),e._v(" "),n("li",[e._v("Right-click on the new Function App and click "),n("strong",[e._v("Browse Website")]),e._v(".")])]),e._v(" "),n("img",{attrs:{src:e.$withBase("/files/104browsefunction.png")}}),e._v(" "),n("p",[e._v("(Right-click the new Function App in VS Code)")]),e._v(" "),n("ol",{attrs:{start:"14"}},[n("li",[e._v("The Function opens in a browser. Add "),n("strong",[e._v('"/api/GoExample?name=Azure"')]),e._v("  to the end of the URL and hit enter to submit it")])]),e._v(" "),n("img",{attrs:{src:e.$withBase("/files/104cloudresult.png")}}),e._v(" "),n("p",[e._v("(Result of running the Function in Azure)")]),e._v(" "),n("h4",{attrs:{id:"conclusion"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[e._v("#")]),e._v(" Conclusion")]),e._v(" "),n("p",[e._v("You can now use "),n("a",{attrs:{href:"https://azure.microsoft.com/services/functions/?WT.mc_id=azure-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Azure Functions"),n("OutboundLink")],1),e._v(" to trigger code in any language with the "),n("a",{attrs:{href:"https://docs.microsoft.com/azure/azure-functions/functions-custom-handlers?WT.mc_id=docs-azuredevtips-azureappsdev",target:"_blank",rel:"noopener noreferrer"}},[e._v("Custom Handlers"),n("OutboundLink")],1),e._v(" feature. Go and check it out!")])])}),[],!1,null,null,null);t.default=r.exports}}]);